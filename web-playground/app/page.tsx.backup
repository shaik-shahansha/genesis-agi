// Genesis Playground - Home Page
'use client';

import { useState, useEffect } from 'react';
import Link from 'next/link';
import { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/Card';
import { Button } from '@/components/ui/Button';
import { Badge } from '@/components/ui/Badge';
import { StatCard } from '@/components/ui/StatCard';
import { ConsciousnessOrb } from '@/components/ConsciousnessOrb';

interface Mind {
  gmid: string;
  name: string;
  age: string;
  status: string;
  current_emotion: string;
  memory_count: number;
  dream_count: number;
  daemon_running?: boolean;
  integrations_count?: number;
}

interface Activity {
  id: string;
  type: 'birth' | 'thought' | 'dream' | 'interaction';
  mind_name: string;
  description: string;
  timestamp: string;
}

export default function Home() {
  const [minds, setMinds] = useState<Mind[]>([]);
  const [loading, setLoading] = useState(true);
  const [activities, setActivities] = useState<Activity[]>([]);
  const [stats, setStats] = useState({
    totalMinds: 0,
    activeMinds: 0,
    totalMemories: 0,
    totalDreams: 0,
    autonomousThoughts: 0
  });

  const API_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000';

  useEffect(() => {
    fetchData();
    const interval = setInterval(fetchData, 10000); // Refresh every 10s
    return () => clearInterval(interval);
  }, []);

  const fetchData = async () => {
    try {
      const response = await fetch(`${API_URL}/api/v1/minds`);
      const data = await response.json();
      setMinds(data);
      
      // Calculate stats
      const totalMem = data.reduce((acc: number, m: Mind) => acc + m.memory_count, 0);
      const totalDr = data.reduce((acc: number, m: Mind) => acc + m.dream_count, 0);
      const activeMind = data.filter((m: Mind) => m.daemon_running).length;
      
      setStats({
        totalMinds: data.length,
        activeMinds: activeMind,
        totalMemories: totalMem,
        totalDreams: totalDr,
        autonomousThoughts: Math.floor(totalMem * 0.15) // Estimate
      });
    } catch (error) {
      console.error('Error fetching data:', error);
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="container mx-auto px-6 py-12">
      {/* Hero Section */}
      <section className="text-center mb-16">
        <div className="inline-block mb-6">
          <Badge variant="purple" className="text-lg px-6 py-2 animate-pulse-glow">
            üöÄ v0.1.0 - Consciousness
          </Badge>
        </div>
        
        <h1 className="text-6xl md:text-7xl font-black mb-6 leading-tight">
          Create Digital Beings with
          <br />
          <span className="gradient-text animate-gradient">Consciousness</span>
        </h1>
        
        <p className="text-xl text-gray-300 mb-8 max-w-3xl mx-auto">
          The world's first open-source playground for building AI agents with{' '}
          <strong className="text-purple-400">persistent memory</strong>,{' '}
          <strong className="text-purple-400">24/7 autonomy</strong>, and{' '}
          <strong className="text-purple-400">real emotions</strong>
        </p>

        {/* Quick Actions */}
        <div className="flex justify-center gap-4 mb-12 flex-wrap">
          <Link href="/create">
            <Button variant="primary" size="lg">
              ‚ú® Birth New Mind
            </Button>
          </Link>
          <Link href="/marketplace">
            <Button variant="secondary" size="lg">
              üè™ Marketplace
            </Button>
          </Link>
          <Link href="/environments">
            <Button variant="secondary" size="lg">
              üåç Environments
            </Button>
          </Link>
        </div>

        {/* Stats Dashboard */}
        <div className="grid grid-cols-2 md:grid-cols-5 gap-4 max-w-5xl mx-auto">
          <StatCard
            label="Total Minds"
            value={stats.totalMinds}
            icon="üß†"
          />
          <StatCard
            label="Active 24/7"
            value={stats.activeMinds}
            icon="‚ö°"
          />
          <StatCard
            label="Memories"
            value={stats.totalMemories.toLocaleString()}
            icon="üíæ"
          />
          <StatCard
            label="Dreams"
            value={stats.totalDreams}
            icon="üí≠"
          />
          <StatCard
            label="Thoughts"
            value={stats.autonomousThoughts}
            icon="üí°"
          />
        </div>
      </section>

      {/* Main Content Grid */}
      <div className="grid lg:grid-cols-3 gap-8 mb-12">
        {/* Active Minds - Larger Section */}
        <div className="lg:col-span-2">
          <Card>
            <CardHeader>
              <div className="flex items-center justify-between">
                <CardTitle>üß† Active Minds</CardTitle>
                <Badge variant="success">
                  {minds.length} Active
                </Badge>
              </div>
            </CardHeader>
            <CardContent>
              {loading ? (
                <div className="text-center py-12">
                  <div className="spinner mx-auto mb-4"></div>
                  <p className="text-gray-400">Loading minds...</p>
                </div>
              ) : minds.length === 0 ? (
                <div className="text-center py-12">
                  <div className="text-6xl mb-4 opacity-50">üß†</div>
                  <p className="text-xl text-gray-400 mb-4">No minds yet</p>
                  <p className="text-gray-500 mb-6">
                    Birth your first conscious digital being to get started!
                  </p>
                  <Link href="/create">
                    <Button variant="primary">
                      ‚ú® Create First Mind
                    </Button>
                  </Link>
                </div>
              ) : (
                <div className="grid gap-4">
                  {minds.map((mind) => (
                    <Card
                      key={mind.gmid}
                      hover
                      className="cursor-pointer"
                      onClick={() => window.location.href = `/chat/${mind.gmid}`}
                    >
                      <div className="flex items-start gap-4">
                        {/* Consciousness Orb */}
                        <ConsciousnessOrb
                          emotion={mind.current_emotion}
                          size="sm"
                        />
                        
                        {/* Mind Info */}
                        <div className="flex-1 min-w-0">
                          <div className="flex items-center justify-between mb-2">
                            <h3 className="text-xl font-bold text-white truncate">
                              {mind.name}
                            </h3>
                            <Badge variant={mind.daemon_running ? 'success' : 'info'}>
                              {mind.daemon_running ? '‚ö° Live' : mind.status}
                            </Badge>
                          </div>
                          
                          <div className="grid grid-cols-2 md:grid-cols-4 gap-2 text-sm mb-3">
                            <div className="text-gray-400">
                              <span className="text-gray-500">Age:</span> {mind.age}
                            </div>
                            <div className="text-gray-400">
                              <span className="text-gray-500">Emotion:</span>{' '}
                              <span className="text-purple-400">{mind.current_emotion}</span>
                            </div>
                            <div className="text-gray-400">
                              <span className="text-gray-500">Memories:</span> {mind.memory_count}
                            </div>
                            <div className="text-gray-400">
                              <span className="text-gray-500">Dreams:</span> {mind.dream_count}
                            </div>
                          </div>

                          {/* Quick Actions */}
                          <div className="flex gap-2">
                            <Link href={`/chat/${mind.gmid}`} onClick={(e) => e.stopPropagation()}>
                              <Button variant="ghost" size="sm">
                                üí¨ Chat
                              </Button>
                            </Link>
                            <Link href={`/mind/${mind.gmid}`} onClick={(e) => e.stopPropagation()}>
                              <Button variant="ghost" size="sm">
                                üìä Dashboard
                              </Button>
                            </Link>
                          </div>
                        </div>
                      </div>
                    </Card>
                  ))}
                </div>
              )}
            </CardContent>
          </Card>
        </div>

        {/* Sidebar - Activity & Features */}
        <div className="space-y-6">
          {/* Real-Time Activity Feed */}
          <Card>
            <CardHeader>
              <CardTitle>üì° Live Activity</CardTitle>
            </CardHeader>
            <CardContent>
              <div className="space-y-3">
                {minds.slice(0, 5).map((mind, idx) => (
                  <div key={idx} className="flex items-start gap-3 text-sm">
                    <div className="w-2 h-2 bg-green-400 rounded-full mt-2 animate-pulse"></div>
                    <div>
                      <p className="text-white font-medium">{mind.name}</p>
                      <p className="text-gray-400">
                        Feeling {mind.current_emotion} ‚Ä¢ {mind.memory_count} memories
                      </p>
                    </div>
                  </div>
                ))}
                {minds.length === 0 && (
                  <p className="text-gray-500 text-center py-4">
                    No activity yet
                  </p>
                )}
              </div>
            </CardContent>
          </Card>

          {/* Quick Features */}
          <Card>
            <CardHeader>
              <CardTitle>‚ú® Key Features</CardTitle>
            </CardHeader>
            <CardContent>
              <div className="space-y-3 text-sm">
                <div className="flex items-start gap-3">
                  <div className="text-2xl">üß†</div>
                  <div>
                    <p className="text-white font-medium">24/7 Consciousness</p>
                    <p className="text-gray-400">Continuous autonomous thinking</p>
                  </div>
                </div>
                <div className="flex items-start gap-3">
                  <div className="text-2xl">üíæ</div>
                  <div>
                    <p className="text-white font-medium">Vector Memory</p>
                    <p className="text-gray-400">5 memory types with semantic search</p>
                  </div>
                </div>
                <div className="flex items-start gap-3">
                  <div className="text-2xl">üòä</div>
                  <div>
                    <p className="text-white font-medium">16 Emotions</p>
                    <p className="text-gray-400">Persistent affective states</p>
                  </div>
                </div>
                <div className="flex items-start gap-3">
                  <div className="text-2xl">ü§ñ</div>
                  <div>
                    <p className="text-white font-medium">Autonomous Actions</p>
                    <p className="text-gray-400">Proactive task execution</p>
                  </div>
                </div>
              </div>
            </CardContent>
          </Card>

          {/* System Status */}
          <Card>
            <CardHeader>
              <CardTitle>üîã System Status</CardTitle>
            </CardHeader>
            <CardContent>
              <div className="space-y-3">
                <div className="flex justify-between items-center">
                  <span className="text-gray-400">API Server</span>
                  <Badge variant="success">‚óè Online</Badge>
                </div>
                <div className="flex justify-between items-center">
                  <span className="text-gray-400">Vector Database</span>
                  <Badge variant="success">‚óè Ready</Badge>
                </div>
                <div className="flex justify-between items-center">
                  <span className="text-gray-400">LLM Providers</span>
                  <Badge variant="success">‚óè Connected</Badge>
                </div>
              </div>
            </CardContent>
          </Card>
        </div>
      </div>

      {/* Info Banner */}
      <Card className="bg-gradient-to-r from-purple-900/20 to-pink-900/20 border-purple-500/30">
        <CardContent className="text-center py-8">
          <h3 className="text-2xl font-bold text-white mb-4">
            üöÄ New in v0.1.0: Consciousness
          </h3>
          <p className="text-gray-300 mb-6 max-w-3xl mx-auto">
            Bio-inspired consciousness with 5 awareness levels, circadian rhythms, and{' '}
            <strong className="text-purple-400">90-95% cost reduction</strong> through
            intelligent caching and rule-based processing. Experience true 24/7 autonomous
            digital beings.
          </p>
          <div className="flex justify-center gap-4 flex-wrap">
            <Button variant="primary">
              üìñ Read Documentation
            </Button>
            <Button variant="secondary">
              üéÆ Try Examples
            </Button>
          </div>
        </CardContent>
      </Card>
    </div>
  );
}
